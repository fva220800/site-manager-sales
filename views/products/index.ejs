<!DOCTYPE html>
<html lang="en">
  <%- include('../partials/head.ejs') %>
  <body>
    <div class="container-xxl">
      <%- include('../partials/header.ejs') %>
      <main>
        <h1 class="mt-3">Продукты</h1>
        <table class="table mt-3">
          <thead>
            <tr>
              <th scope="col">Название</th>
              <th scope="col">Количество</th>
              <th scope="col">Цена за единицу</th>
              <th scope="col"></th>
            </tr>
          </thead>
          <tbody>
            <% if (products.length) { %> <% products.forEach(({id, name, count,
            price}) => { %>
            <tr>
              <th><%= name %></th>
              <th><%= count %></th>
              <th><%= price %></th>
              <th>
                <a href="/products/edit/<%= id %>" class="btn btn-primary"
                  >Редактировать</a
                >
                <button class="btn btn-primary" data-id="<%= id %>">
                  Удалить
                </button>
              </th>
            </tr>
            <% }) %> <% } %>
          </tbody>
        </table>
        <a href="/products/add" class="btn btn-primary">Добавить</a>
      </main>
    </div>
    <%- include('../partials/scripts.ejs') %>
    <script>
      document.addEventListener('click', (event) => {
        const id = event.target?.dataset?.id || null
        if (id && confirm('Вы действительно хотите удалить')) {
          fetch(`/products/${id}`, {
            method: 'DELETE',
          }).then(() => {
            window.location.reload()
          })
        }
      })
    </script>
  </body>
</html>
