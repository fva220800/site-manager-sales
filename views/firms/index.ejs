<!DOCTYPE html>
<html lang="en">
  <%- include('../partials/head.ejs') %>
  <body>
    <div class="container-xxl">
      <%- include('../partials/header.ejs') %>
      <main>
        <h1 class="mt-3">Фирмы</h1>
        <table class="table mt-3">
          <thead>
            <tr>
              <th scope="col">Название</th>
              <th scope="col">Время работы</th>
              <th scope="col">Адрес(страна, город, улица, номер дома)</th>
              <th scope="col">Фамилия начальника</th>
              <th scope="col">Имя начальника</th>
              <th scope="col">Отчество начальника</th>
              <th scope="col"></th>
            </tr>
          </thead>
          <tbody>
            <% if (firms.length) { %> <% firms.forEach(({id, name, time,
            address, surname, firstname, patronymic}) => { %>
            <tr>
              <th><%= name %></th>
              <th><%= time %></th>
              <th><%= address %></th>
              <th><%= surname %></th>
              <th><%= firstname %></th>
              <th><%= patronymic %></th>
              <th>
                <a href="/firms/edit/<%= id %>" class="btn btn-primary"
                  >Редактировать</a
                >
                <button class="btn btn-primary" data-id="<%= id %>">
                  Удалить
                </button>
              </th>
            </tr>
            <% }) %> <% } %>
          </tbody>
        </table>
        <a href="/firms/add" class="btn btn-primary">Добавить</a>
      </main>
    </div>
    <%- include('../partials/scripts.ejs') %>
    <script>
      document.addEventListener('click', (event) => {
        const id = event.target?.dataset?.id || null
        if (id && confirm('Вы действительно хотите удалить')) {
          fetch(`/firms/${id}`, {
            method: 'DELETE',
          }).then(() => {
            window.location.reload()
          })
        }
      })
    </script>
  </body>
</html>
