<!DOCTYPE html>
<html lang="en">
  <%- include('../partials/head.ejs') %>
  <body>
    <div class="container-xxl">
      <%- include('../partials/header.ejs') %>
      <main>
        <h1 class="mt-3">Продажы</h1>
        <table class="table mt-3">
          <thead>
            <tr>
              <th scope="col">Клиент</th>
              <th scope="col">Продукт</th>
              <th scope="col">Количество проданной продукции</th>
              <th scope="col">Общая стоимость</th>
              <th scope="col">Дата продажи</th>
              <th scope="col"></th>
            </tr>
          </thead>
          <tbody>
            <% if (sales.length) { %> <% sales.forEach(({id, client, product,
            count, price, date}) => { %>
            <tr>
              <th><%= client %></th>
              <th><%= product %></th>
              <th><%= count %></th>
              <th><%= price %></th>
              <th><%= date %></th>
              <th>
                <a href="/sales/edit/<%= id %>" class="btn btn-primary"
                  >Редактировать</a
                >
                <button class="btn btn-primary" data-id="<%= id %>">
                  Удалить
                </button>
              </th>
            </tr>
            <% }) %> <% } %>
          </tbody>
        </table>
        <a href="/sales/add" class="btn btn-primary">Добавить</a>
      </main>
    </div>
    <%- include('../partials/scripts.ejs') %>
    <script>
      document.addEventListener('click', (event) => {
        const id = event.target?.dataset?.id || null
        if (id && confirm('Вы действительно хотите удалить')) {
          fetch(`/sales/${id}`, {
            method: 'DELETE',
          }).then(() => {
            window.location.reload()
          })
        }
      })
    </script>
  </body>
</html>
